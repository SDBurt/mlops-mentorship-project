version: 2

models:
  # ==========================================================================
  # Analytics: Payment Summary KPIs (15-minute intervals)
  # ==========================================================================
  - name: analytics_payment_summary
    description: |
      High-level payment KPIs in 15-minute intervals for real-time dashboards.
      Includes transaction counts, revenue, rates, and provider breakdown.
      Best used for: Real-time dashboards, KPI monitoring
    config:
      tags: ['analytics', 'payments', 'kpis', 'intervals']
    columns:
      - name: interval_key
        description: "Unique key for the 15-minute interval"
        tests:
          - unique
          - not_null
      - name: interval_label
        description: "Human-readable interval label (YYYY-MM-DD HH:MM)"
      - name: total_transactions
        description: "Total number of payment transactions in this interval"
      - name: total_revenue_dollars
        description: "Total revenue in dollars for this interval"
      - name: success_rate_pct
        description: "Percentage of successful transactions"

  # ==========================================================================
  # Analytics: Payment Trends
  # ==========================================================================
  - name: analytics_payment_trends
    description: |
      Time-series payment data with daily granularity.
      Includes date dimension attributes, metrics, moving averages, and cumulative totals.
      Best used for: Trend charts, time-series analysis, forecasting
    config:
      tags: ['analytics', 'payments', 'trends']
    columns:
      - name: trend_key
        description: "Surrogate key for the trend row"
        tests:
          - unique
          - not_null
      - name: date_key
        description: "Date of the metrics"
        tests:
          - not_null
      - name: transaction_count
        description: "Number of transactions on this date"
      - name: revenue_dollars
        description: "Revenue in dollars for this date"
      - name: ma7_transaction_count
        description: "7-day moving average of transaction count"
      - name: cumulative_revenue_cents
        description: "Running total of revenue"

  # ==========================================================================
  # Analytics: Customer Segments
  # ==========================================================================
  - name: analytics_customer_segments
    description: |
      Customer segmentation data for analysis and targeting.
      Segments by: tier, fraud risk, churn risk, payment method preference.
      Best used for: Segment analysis, pie charts, cohort analysis
    config:
      tags: ['analytics', 'payments', 'customers']
    columns:
      - name: segment_type
        description: "Type of segmentation (tier, fraud_risk, churn_risk, payment_method)"
        tests:
          - not_null
          - accepted_values:
              values: ['tier', 'fraud_risk', 'churn_risk', 'payment_method']
      - name: segment_value
        description: "The segment value within the type"
      - name: customer_count
        description: "Number of customers in this segment"
      - name: customer_pct
        description: "Percentage of total customers"
      - name: revenue_pct
        description: "Percentage of total revenue from this segment"

  # ==========================================================================
  # Analytics: Risk Overview (15-minute intervals)
  # ==========================================================================
  - name: analytics_risk_overview
    description: |
      Fraud and risk metrics in 15-minute intervals for monitoring.
      Includes risk category distribution, scores, and provider breakdown.
      Best used for: Risk dashboards, fraud monitoring, real-time alerts
    config:
      tags: ['analytics', 'payments', 'risk', 'intervals']
    columns:
      - name: interval_key
        description: "Unique key for the 15-minute interval"
        tests:
          - unique
          - not_null
      - name: interval_label
        description: "Human-readable interval label (YYYY-MM-DD HH:MM)"
      - name: total_transactions
        description: "Number of transactions in this interval"
      - name: high_risk_count
        description: "Number of high-risk transactions"
      - name: avg_fraud_score
        description: "Average fraud score for this interval"

  # ==========================================================================
  # Analytics: Provider Comparison (15-minute intervals)
  # ==========================================================================
  - name: analytics_provider_comparison
    description: |
      Payment provider performance in 15-minute intervals.
      One row per provider per interval for time-series analysis.
      Best used for: Provider trend analysis, real-time comparison
    config:
      tags: ['analytics', 'payments', 'providers', 'intervals']
    columns:
      - name: interval_provider_key
        description: "Unique key for interval + provider combination"
        tests:
          - unique
          - not_null
      - name: interval_label
        description: "Human-readable interval label (YYYY-MM-DD HH:MM)"
      - name: provider
        description: "Payment provider name"
        tests:
          - not_null
      - name: total_transactions
        description: "Transactions for this provider in this interval"
      - name: success_rate_pct
        description: "Transaction success rate for this provider"
      - name: total_revenue_dollars
        description: "Revenue in dollars for this provider"

  # ==========================================================================
  # Analytics: Payment Intervals (15-minute buckets)
  # ==========================================================================
  - name: analytics_payment_intervals
    description: |
      Aggregated payment metrics in 15-minute intervals.
      Core time-series model with transaction, revenue, risk, and provider breakdown.
      Best used for: Real-time monitoring, throughput analysis
    config:
      tags: ['analytics', 'payments', 'intervals', 'realtime']
    columns:
      - name: interval_key
        description: "Unique key for the 15-minute interval"
        tests:
          - unique
          - not_null
      - name: interval_label
        description: "Human-readable interval label (YYYY-MM-DD HH:MM)"
      - name: transaction_count
        description: "Total transactions in this interval"
      - name: revenue_dollars
        description: "Total revenue in dollars"
      - name: success_rate_pct
        description: "Transaction success rate"
      - name: transactions_per_minute
        description: "Average throughput (transactions/minute)"
