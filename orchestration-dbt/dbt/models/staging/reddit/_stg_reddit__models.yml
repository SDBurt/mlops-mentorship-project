version: 2

models:
  # ==========================================================================
  # Staging Model: Reddit Posts
  # ==========================================================================
  - name: stg_reddit_posts
    description: |
      Staging view for all Reddit posts across all tracked subreddits.
      Unions posts from worldnews, economics, finance, wallstreetbets, and investing.
      Source-conformed with basic type casting and cleaning.
    config:
      tags: ['staging', 'reddit', 'posts']
    columns:
      - name: post_id
        description: "Reddit post ID (unique across all subreddits)"
        tests:
          - unique
          - not_null

      - name: post_name
        description: "Full post name with type prefix (t3_<id>)"
        tests:
          - not_null

      - name: subreddit
        description: "Subreddit name where post was created"
        tests:
          - not_null
          - accepted_values:
              values: ['worldnews', 'economics', 'finance', 'wallstreetbets', 'investing']

      - name: created_at
        description: "UTC timestamp when post was created"
        tests:
          - not_null

      - name: title
        description: "Post title"
        tests:
          - not_null

      - name: score
        description: "Net upvotes (upvotes - downvotes)"
        tests:
          - not_null

      - name: upvote_ratio
        description: "Ratio of upvotes to total votes (0.0 to 1.0)"
        tests:
          - not_null

      - name: num_comments
        description: "Total number of comments on post"
        tests:
          - not_null

      - name: author
        description: "Reddit username of post author"
        tests:
          - not_null

      - name: is_self
        description: "True if post is self/text post (not link)"

      - name: is_video
        description: "True if post contains video"

      - name: over_18
        description: "True if post is marked NSFW/18+"

  # ==========================================================================
  # Staging Model: Reddit Comments
  # ==========================================================================
  - name: stg_reddit_comments
    description: |
      Staging view for all Reddit comments across all tracked subreddits.
      Unions comments from worldnews, economics, finance, wallstreetbets, and investing.
      Includes parsed threading relationships (link_id, parent_id).
    config:
      tags: ['staging', 'reddit', 'comments']
    columns:
      - name: comment_id
        description: "Reddit comment ID (unique across all subreddits)"
        tests:
          - unique
          - not_null

      - name: comment_name
        description: "Full comment name with type prefix (t1_<id>)"
        tests:
          - not_null

      - name: subreddit
        description: "Subreddit name where comment was posted"
        tests:
          - not_null
          - accepted_values:
              values: ['worldnews', 'economics', 'finance', 'wallstreetbets', 'investing']

      - name: created_at
        description: "UTC timestamp when comment was created"
        tests:
          - not_null

      - name: link_id
        description: "Full link ID of parent post (t3_<post_id>)"
        tests:
          - not_null

      - name: post_id
        description: "Parsed post ID (without t3_ prefix)"
        tests:
          - not_null

      - name: parent_id
        description: "Full parent ID (t3_<post_id> or t1_<comment_id>)"
        tests:
          - not_null

      - name: parent_type
        description: "Type of parent (post or comment)"
        tests:
          - not_null
          - accepted_values:
              values: ['post', 'comment', 'unknown']

      - name: parent_id_clean
        description: "Parsed parent ID (without type prefix)"
        tests:
          - not_null

      - name: depth
        description: "Comment depth in thread (0 = top-level)"
        tests:
          - not_null

      - name: body
        description: "Comment text body"

      - name: score
        description: "Net upvotes (upvotes - downvotes)"
        tests:
          - not_null

      - name: author
        description: "Reddit username of comment author"
        tests:
          - not_null

      - name: is_submitter
        description: "True if comment author is OP (original poster)"

  # ==========================================================================
  # Staging Model: Reddit Subreddits
  # ==========================================================================
  - name: stg_reddit_subreddits
    description: |
      Staging view for Reddit subreddit metadata.
      Unions metadata from all tracked subreddits.
      Contains community information, settings, and metrics.
    config:
      tags: ['staging', 'reddit', 'subreddits', 'metadata']
    columns:
      - name: subreddit_id
        description: "Reddit subreddit ID (unique)"
        tests:
          - unique
          - not_null

      - name: subreddit
        description: "Subreddit display name (e.g., 'worldnews')"
        tests:
          - unique
          - not_null
          - accepted_values:
              values: ['worldnews', 'economics', 'finance', 'wallstreetbets', 'investing']

      - name: title
        description: "Subreddit title/heading"
        tests:
          - not_null

      - name: subscribers
        description: "Total number of subscribers"
        tests:
          - not_null

      - name: created_at
        description: "UTC timestamp when subreddit was created"
        tests:
          - not_null

      - name: subreddit_type
        description: "Subreddit type (public, private, restricted, etc.)"
        tests:
          - not_null
          - accepted_values:
              values: ['public', 'private', 'restricted', 'archived', 'gold_restricted', 'employees_only', 'user']

      - name: is_over_18
        description: "True if subreddit is marked NSFW/18+"
