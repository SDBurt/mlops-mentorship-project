# Dagster Data Orchestration Platform Configuration
# See values-default.yaml for all available options

# Dagster Webserver
dagsterWebserver:
  service:
    type: ClusterIP
    port: 80
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  workspace:
    enabled: false
    # Workspace is auto-generated by dagster-user-deployments subchart

# Dagster Daemon (schedules, sensors, run queue)
dagsterDaemon:
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Run Launcher - K8s jobs for pipeline runs
runLauncher:
  type: K8sRunLauncher
  config:
    k8sRunLauncher:
      envConfigMaps: []
      envSecrets: []

# Compute Log Manager - Store logs in Garage/S3
# TODO (Phase 2): Enable S3 compute logs for lakehouse integration
computeLogManager:
  type: NoOpComputeLogManager  # Default: logs not stored
  # When ready to integrate with Garage, uncomment below:
  # type: S3ComputeLogManager
  # config:
  #   s3ComputeLogManager:
  #     bucket: lakehouse-dagster-logs
  #     localDir: /tmp/dagster-logs
  #     prefix: compute-logs/
  #     endpointUrl: http://garage.garage.svc.cluster.local:3900
  #     useSsl: false
  #     # Access keys will be provided via envSecrets

# User Code Deployments - enabled to provide workspace configuration
# Note: Dagster requires workspace config. The example deployment will be scaled to 0 after install.
# You'll replace this with your own DBT/Dagster code in Phase 2
dagster-user-deployments:
  enabled: true
  enableSubchart: true
  deployments:
    - name: "dagster-user-code"
      image:
        repository: "dagster/user-code-example"
        tag: "1.11.15"
        pullPolicy: IfNotPresent
      port: 3030
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
        limits:
          cpu: 500m
          memory: 512Mi

# PostgreSQL - Internal database for Dagster metadata
postgresql:
  enabled: true
  postgresqlUsername: dagster
  postgresqlPassword: dagster123  # TODO: Change for production
  postgresqlDatabase: dagster
  service:
    port: 5432
  persistence:
    enabled: true
    size: 5Gi

# RabbitMQ - Not needed with K8sRunLauncher
rabbitmq:
  enabled: false

# Service Account
serviceAccount:
  create: true

# Ingress - Disabled (using port-forward for local dev)
ingress:
  enabled: false
