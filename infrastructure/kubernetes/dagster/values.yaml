# Dagster Data Orchestration Platform Configuration
# See values-default.yaml for all available options

# Dagster Webserver
dagsterWebserver:
  service:
    type: ClusterIP
    port: 80
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  workspace:
    enabled: false
    # Workspace is auto-generated by dagster-user-deployments subchart

# Dagster Daemon (schedules, sensors, run queue)
dagsterDaemon:
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Run Launcher - K8s jobs for pipeline runs
runLauncher:
  type: K8sRunLauncher
  config:
    k8sRunLauncher:
      envConfigMaps: []
      envSecrets: []

# Compute Log Manager - Store logs in MinIO/S3
# TODO (Phase 2): Enable S3 compute logs for lakehouse integration
computeLogManager:
  type: NoOpComputeLogManager  # Default: logs not stored
  # When ready to integrate with MinIO, uncomment below:
  # type: S3ComputeLogManager
  # config:
  #   s3ComputeLogManager:
  #     bucket: lakehouse-dagster-logs
  #     localDir: /tmp/dagster-logs
  #     prefix: compute-logs/
  #     endpointUrl: http://minio:9000  # Same namespace - simplified DNS
  #     useSsl: false
  #     # Access keys will be provided via envSecrets

# User Code Deployments - orchestration-dagster with Iceberg integration
dagster-user-deployments:
  enabled: true
  enableSubchart: true
  deployments:
    - name: "orchestration-dagster"
      image:
        repository: "orchestration-dagster"
        tag: "latest"
        pullPolicy: IfNotPresent
      port: 3030
      envConfigMaps:
        - name: dagster-user-code-env
      envSecrets:
        - name: dagster-user-code-secrets
      resources:
        requests:
          cpu: 200m
          memory: 512Mi
        limits:
          cpu: 1000m
          memory: 2Gi

# PostgreSQL - Internal database for Dagster metadata
# IMPORTANT: Password should be provided via Kubernetes Secret or Helm --set flag
# See dagster/secrets.yaml.example for secret-based approach
postgresql:
  enabled: true
  postgresqlUsername: dagster
  postgresqlPassword: "CHANGEME_DAGSTER_PASSWORD"  # Override via secret or --set flag
  postgresqlDatabase: dagster
  service:
    port: 5432
  persistence:
    enabled: true
    size: 5Gi

# RabbitMQ - Not needed with K8sRunLauncher
rabbitmq:
  enabled: false

# Service Account
serviceAccount:
  create: true

# Ingress - Disabled (using port-forward for local dev)
ingress:
  enabled: false
