# Trino Distributed SQL Query Engine Configuration
# Queries Iceberg tables stored in MinIO S3

# Coordinator configuration
coordinator:
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m

# Worker configuration
worker:
  replicas: 2  # Start with 2 workers for local development
  resources:
    requests:
      memory: 2Gi
      cpu: 1000m
    limits:
      memory: 4Gi
      cpu: 2000m

# Service configuration
service:
  type: ClusterIP  # Use ClusterIP for internal access only
  port: 8080

# Iceberg catalog configuration for MinIO S3
# Using JDBC catalog with Dagster's PostgreSQL for metadata
# Data remains in MinIO S3 (where DLT writes Iceberg tables)
additionalCatalogs:
  lakehouse: |
    connector.name=iceberg
    iceberg.catalog.type=jdbc
    iceberg.jdbc-catalog.driver-class=org.postgresql.Driver
    iceberg.jdbc-catalog.connection-url=jdbc:postgresql://dagster-postgresql:5432/dagster
    iceberg.jdbc-catalog.connection-user=dagster
    iceberg.jdbc-catalog.connection-password=dagster
    iceberg.jdbc-catalog.catalog-name=lakehouse
    iceberg.jdbc-catalog.default-warehouse-dir=s3://lakehouse/iceberg/
    fs.native-s3.enabled=true
    s3.endpoint=http://minio:9000
    s3.path-style-access=true
    s3.region=us-east-1
    s3.aws-access-key-id=${ENV:S3_ACCESS_KEY}
    s3.aws-secret-access-key=${ENV:S3_SECRET_KEY}

# Environment variables for S3 credentials (using MinIO credentials)
env:
  - name: S3_ACCESS_KEY
    value: admin
  - name: S3_SECRET_KEY
    value: minio123

# Server configuration
server:
  config:
    query:
      maxMemory: "4GB"
      maxMemoryPerNode: "2GB"
    memory:
      heapHeadroomPerNode: "1GB"

# JVM configuration
jvm:
  maxHeapSize: "8G"
  gcMethod:
    type: "UseG1GC"
    g1:
      heapRegionSize: "32M"
