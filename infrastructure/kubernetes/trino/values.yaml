# Trino Distributed SQL Query Engine Configuration
# Queries Iceberg tables stored in MinIO S3

# Coordinator configuration
coordinator:
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m

# Worker configuration
worker:
  replicas: 2  # Start with 2 workers for local development
  resources:
    requests:
      memory: 2Gi
      cpu: 1000m
    limits:
      memory: 4Gi
      cpu: 2000m

# Service configuration
service:
  type: ClusterIP  # Use ClusterIP for internal access only
  port: 8080

# Iceberg catalog configuration for MinIO S3
# Using Polaris REST catalog for unified catalog management
# Data stored in MinIO S3 (where DLT writes Iceberg tables)
additionalCatalogs:
  lakehouse: |
    connector.name=iceberg
    iceberg.catalog.type=rest
    iceberg.rest-catalog.uri=http://polaris:8181/api/catalog
    iceberg.rest-catalog.warehouse=lakehouse
    iceberg.rest-catalog.security=OAUTH2
    # OAuth credentials provided via environment variable (from Secret)
    iceberg.rest-catalog.oauth2.credential=${ENV:POLARIS_OAUTH_CREDENTIAL}
    iceberg.rest-catalog.oauth2.scope=PRINCIPAL_ROLE:ALL
    fs.native-s3.enabled=true
    s3.endpoint=http://minio:9000
    s3.path-style-access=true
    s3.region=us-east-1
    s3.aws-access-key=${ENV:S3_ACCESS_KEY}
    s3.aws-secret-key=${ENV:S3_SECRET_KEY}

# Environment variables for S3 and Polaris credentials
# IMPORTANT: These MUST be provided via Secret (trino-env-secrets)
# Secret is required - no fallback defaults for security
env:
  - name: S3_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        name: trino-env-secrets
        key: S3_ACCESS_KEY
  - name: S3_SECRET_KEY
    valueFrom:
      secretKeyRef:
        name: trino-env-secrets
        key: S3_SECRET_KEY
  - name: POLARIS_OAUTH_CREDENTIAL
    valueFrom:
      secretKeyRef:
        name: trino-env-secrets
        key: POLARIS_OAUTH_CREDENTIAL

# Server configuration
server:
  config:
    query:
      maxMemory: "4GB"
      maxMemoryPerNode: "2GB"
    memory:
      heapHeadroomPerNode: "1GB"

# JVM configuration
jvm:
  maxHeapSize: "8G"
  gcMethod:
    type: "UseG1GC"
    g1:
      heapRegionSize: "32M"
